<!DOCTYPE html>
<html lang="en-us">
<title>Emacs Capture Anywhere | 半斤八两</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.73.0" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://vritser.github.io/css/index.css">
<link rel="stylesheet" href="https://vritser.github.io/css/classes.css">
<link rel="canonical" href="https://vritser.github.io/posts/capture-anywhere/">
<link rel="alternate" type="application/rss+xml" href="" title="半斤八两">

<body>

<header class="icons">
  
  
    <nav>
    
      <a href="/" >
        
          
          
          <span class="hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg></span>
          <span >Home</span>
        
      </a>
    
      <a href="/categories/" >
        
          Categories
        
      </a>
    
      <a href="/tags/" >
        
          
          
          <span class="hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg></span>
          <span >Tags</span>
        
      </a>
    
      <a href="/about/" >
        
          
          
          <span class="hidden"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-352 96c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H86.4C74 384 64 375.4 64 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2zM512 312c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-64c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"/></svg></span>
          <span >About</span>
        
      </a>
    
    </nav>
  
    <nav>
    
      <a href="mailto:" >
        
          
          
          <span ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></span>
          <span class="hidden">Mail</span>
        
      </a>
    
      <a href="https://github.com/vritser" >
        
          
          
          <span ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
          <span class="hidden">Github</span>
        
      </a>
    
    </nav>
  
  
</header>

<article>
  <header>
    <a href="https://vritser.github.io/categories/workspace/">WORKSPACE</a><h1>Emacs Capture Anywhere</h1>
    <time datetime="2020-07-27T22:35:00&#43;08:00">July 27, 2020</time>
  </header>
  <h2 id="effects">Effects</h2>
<p><img src="/QQ20200727-222601@2x.png" alt="">
<img src="/QQ20200727-223013@2x.png" alt=""></p>
<h2 id="register-emacsclient-as-the-org-protocol-handler">Register emacsclient as the <code>org-protocol</code> handler</h2>
<p><strong>For macOS</strong></p>
<p>Start ScriptEditor. Paste the following snippets:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">on emacsclient<span style="color:#666">(</span>input<span style="color:#666">)</span>
  <span style="color:#a2f;font-weight:bold">do</span> shell script <span style="color:#b44">&#34;/path/to/your/emacsclient -n -c &#39;&#34;</span> &amp; input &amp; <span style="color:#b44">&#34;&#39;&#34;</span>
  tell application <span style="color:#b44">&#34;Emacs&#34;</span> to activate
end emacsclient

on open location input
  emacsclient<span style="color:#666">(</span>input<span style="color:#666">)</span>
end open location

on open inputs
  repeat with raw_input in inputs
    <span style="color:#a2f">set</span> input to POSIX path of raw_input
    emacsclient<span style="color:#666">(</span>input<span style="color:#666">)</span>
  end repeat
end open

on run
  <span style="color:#a2f;font-weight:bold">do</span> shell script emacsclient<span style="color:#666">(</span><span style="color:#b44">&#34;&#34;</span><span style="color:#666">)</span>
end run
</code></pre></div><p>Adjust the paths and save it (with &lsquo;type&rsquo; as Application) under <code>/Applications/EmacsClient.app</code> (or whatever else you choose).
Edit the file <code>/Applications/Emacsclient.app/Contents/Info.plist</code></p>
<p>And add there the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleURLTypes<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
<span style="color:#008000;font-weight:bold">&lt;array&gt;</span>
  <span style="color:#008000;font-weight:bold">&lt;dict&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleURLName<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>org-protocol<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleURLSchemes<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;array&gt;</span>
      <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>org-protocol<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;/array&gt;</span>
  <span style="color:#008000;font-weight:bold">&lt;/dict&gt;</span>
<span style="color:#008000;font-weight:bold">&lt;/array&gt;</span>

<span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleDocumentTypes<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
<span style="color:#008000;font-weight:bold">&lt;array&gt;</span>
  <span style="color:#008000;font-weight:bold">&lt;dict&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleTypeExtensions<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;array&gt;</span>
      <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>*<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;/array&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleTypeName<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>All<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleTypeOSTypes<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;array&gt;</span>
      <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>****<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;/array&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;key&gt;</span>CFBundleTypeRole<span style="color:#008000;font-weight:bold">&lt;/key&gt;</span>
    <span style="color:#008000;font-weight:bold">&lt;string&gt;</span>Viewer<span style="color:#008000;font-weight:bold">&lt;/string&gt;</span>
  <span style="color:#008000;font-weight:bold">&lt;/dict&gt;</span>
<span style="color:#008000;font-weight:bold">&lt;/array&gt;</span>
</code></pre></div><p><strong>For Linux</strong></p>
<p>Please refer to <a href="https://github.com/sprig/org-capture-extension#register-emacsclient-as-the-org-protocol-handler">org-protocol handler</a></p>
<h2 id="setup-handlers-in-emacs">Setup handlers in emacs</h2>
<p><strong>Add org-capture template</strong></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(<span style="color:#a2f">setq</span> <span style="color:#b8860b">org-capture-templates</span> <span style="color:#666">`</span>(
  (<span style="color:#b44">&#34;p&#34;</span> <span style="color:#b44">&#34;Protocol&#34;</span> <span style="color:#b8860b">entry</span> (<span style="color:#b8860b">file+headline</span> <span style="color:#b44">&#34;~/Documents/org/notes.org&#34;</span> <span style="color:#b44">&#34;Inbox&#34;</span>)
   <span style="color:#b44">&#34;* [[%:link][%:description]] \n\n %u \n #+BEGIN_QUOTE\n%i\n#+END_QUOTE\n %?&#34;</span>)
  (<span style="color:#b44">&#34;L&#34;</span> <span style="color:#b44">&#34;Protocol Link&#34;</span> <span style="color:#b8860b">entry</span> (<span style="color:#b8860b">file+headline</span> <span style="color:#b44">&#34;~/Documents/org/notes.org&#34;</span> <span style="color:#b44">&#34;Inbox&#34;</span>)
   <span style="color:#b44">&#34;* %? [[%:link][%:description]] \nCaptured On: %U&#34;</span>)
))
</code></pre></div><h2 id="capture-on-browser">Capture on browser</h2>
<p>Save as browser bookmark</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">javascript<span style="color:#666">:</span><span style="color:#a2f">window</span>.open(<span style="color:#b44">&#39;org-protocol://capture?template=p&#39;</span><span style="color:#666">+</span> <span style="color:#b44">&#39;&amp;url=&#39;</span><span style="color:#666">+</span><span style="color:#a2f">encodeURIComponent</span>(<span style="color:#a2f">window</span>.location.href)<span style="color:#666">+</span> <span style="color:#b44">&#39;&amp;title=&#39;</span><span style="color:#666">+</span><span style="color:#a2f">encodeURIComponent</span>(<span style="color:#a2f">document</span>.title)<span style="color:#666">+</span> <span style="color:#b44">&#39;&amp;body=&#39;</span><span style="color:#666">+</span><span style="color:#a2f">encodeURIComponent</span>(<span style="color:#a2f">window</span>.getSelection()));<span style="color:#a2f">window</span>.resizeTo(<span style="color:#666">0</span>,<span style="color:#666">0</span>); <span style="color:#a2f">window</span>.moveTo(<span style="color:#666">0</span>,<span style="color:#a2f">window</span>.screen.availHeight<span style="color:#666">+</span><span style="color:#666">10</span>);
</code></pre></div><h2 id="capture-on-other-apps-using-hammerspoon">Capture on other APPs using hammerspoon</h2>
<p>Add the following to your init.lua:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua"><span style="color:#a2f;font-weight:bold">local</span> hyper <span style="color:#666">=</span> {<span style="color:#b44">&#39;ctrl&#39;</span>, <span style="color:#b44">&#39;option&#39;</span>}
hs.hotkey.bind(hyper, <span style="color:#b44">&#34;d&#34;</span>,
               <span style="color:#a2f;font-weight:bold">function</span> ()
                  <span style="color:#a2f;font-weight:bold">local</span> focusedElement <span style="color:#666">=</span> hs.uielement.focusedElement();

                  <span style="color:#a2f;font-weight:bold">if</span> (focusedElement <span style="color:#666">==</span> <span style="color:#a2f;font-weight:bold">nil</span> <span style="color:#a2f;font-weight:bold">or</span> focusedElement:selectedText() <span style="color:#666">==</span> <span style="color:#b44">&#39;&#39;</span> <span style="color:#a2f;font-weight:bold">or</span> focusedElement:selectedText() <span style="color:#666">==</span> <span style="color:#a2f;font-weight:bold">nil</span>) <span style="color:#a2f;font-weight:bold">then</span>
                     hs.notify.new({title<span style="color:#666">=</span><span style="color:#b44">&#34;Capture&#34;</span>, informativeText <span style="color:#666">=</span> <span style="color:#b44">&#34;No selected text&#34;</span>}):send()
                     <span style="color:#a2f;font-weight:bold">return</span>
                  <span style="color:#a2f;font-weight:bold">end</span>

                  <span style="color:#a2f;font-weight:bold">local</span> focusedWindow <span style="color:#666">=</span> window.focusedWindow()

                  <span style="color:#a2f;font-weight:bold">local</span> url <span style="color:#666">=</span> string.format(<span style="color:#b44">&#34;org-protocol://capture?template=p&amp;url=HammerSpoon&amp;title=%s&amp;body=%s&#34;</span>,
                                            focusedWindow:title(),
                                            focusedElement:selectedText())

                  hs.notify.new({title<span style="color:#666">=</span> <span style="color:#b44">&#34;Capture&#34;</span>, informativeText <span style="color:#666">=</span> focusedWindow:title() <span style="color:#666">..</span> <span style="color:#b44">&#34;</span><span style="color:#b62;font-weight:bold">\n</span><span style="color:#b44">&#34;</span> <span style="color:#666">..</span> focusedElement:selectedText()}):send()
                  hs.execute(string.format(<span style="color:#b44">&#34;open &#39;%s&#39;&#34;</span>, url))
<span style="color:#a2f;font-weight:bold">end</span>)
</code></pre></div><p>Then you can use <code>C-M d</code> to capture selected text</p>
<h2 id="references">References</h2>
<ul>
<li>org-protocol: <a href="https://orgmode.org/worg/org-contrib/org-protocol.html">https://orgmode.org/worg/org-contrib/org-protocol.html</a></li>
<li>org-capture-extension: <a href="https://github.com/sprig/org-capture-extension">https://github.com/sprig/org-capture-extension</a></li>
<li>emacs china: <a href="https://emacs-china.org/t/emacs/10367">https://emacs-china.org/t/emacs/10367</a></li>
</ul>

</article>



</body>

</html>
